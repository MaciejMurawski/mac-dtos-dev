parameters:
  ENVIRONMENT: " "
  SERVICE_CONNECTION: " "
  TF_DIRECTORY: " "

steps:
  - task: TerraformTaskV4@4
    continueOnError: false
    displayName: Terraform Init
    inputs:
      provider: 'azurerm'
      command: 'init'
      workingDirectory: ${{ parameters.TF_DIRECTORY }}
      backendAzureRmUseEnvironmentVariablesForAuthentication: false
      backendServiceArm: ${{ parameters.SERVICE_CONNECTION }}
      backendAzureRmResourceGroupName: $(STATE_RG)
      backendAzureRmStorageAccountName: $(STATE_SA)
      backendAzureRmContainerName: $(STATE_CONT)
      backendAzureRmKey: $(STATE_BLOB)
    env:
      ARM_USE_AZUREAD: true

  - task: TerraformTaskV4@4
    continueOnError: false
    displayName: Terraform Validate
    inputs:
      provider: 'azurerm'
      command: 'validate'
      workingDirectory: ${{ parameters.TF_DIRECTORY }}
